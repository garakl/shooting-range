<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RangeTracker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Safe area handling */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }
        .pt-safe {
            padding-top: env(safe-area-inset-top);
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Tap highlight removal */
        * {
            -webkit-tap-highlight-color: transparent;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    boxShadow: {
                        'up': '0 -4px 6px -1px rgba(0, 0, 0, 0.05), 0 -2px 4px -1px rgba(0, 0, 0, 0.03)',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 text-slate-900 font-sans min-h-screen flex justify-center items-start">
    <div id="root" class="w-full"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons Components ---
        const IconBase = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Target = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 3v9h9"></path></IconBase>;
        const Crosshair = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><line x1="22" y1="12" x2="18" y2="12"></line><line x1="6" y1="12" x2="2" y2="12"></line><line x1="12" y1="6" x2="12" y2="2"></line><line x1="12" y1="22" x2="12" y2="18"></line></IconBase>;
        const XCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><path d="m15 9-6 6"></path><path d="m9 9 6 6"></path></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconBase>;
        const BarChart2 = (props) => <IconBase {...props}><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></IconBase>;
        const History = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 3v9h9"></path><path d="M12 7v5l4 2"></path></IconBase>;
        const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></IconBase>;
        const Calendar = (props) => <IconBase {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></IconBase>;

        // --- Data ---
        const TARGET_TYPES = [
            { id: 'clay', name: 'Clay Target', icon: 'ðŸŸ ' },
            { id: 'eagle', name: 'Eagle', icon: 'ðŸ¦…' },
            { id: 'duck', name: 'Duck', icon: 'ðŸ¦†' },
            { id: 'rabbit', name: 'Rabbit', icon: 'ðŸ‡' },
            { id: 'mouse', name: 'Mouse', icon: 'ðŸ' },
            // Fox Removed
        ];

        function App() {
            const [sessionData, setSessionData] = useState(() => {
                const saved = localStorage.getItem('shooting_current_session');
                // Filter out any old data for removed targets (like fox) if loading from cache
                const initial = saved ? JSON.parse(saved) : {};
                
                // Ensure all current targets exist in state
                const cleanState = {};
                TARGET_TYPES.forEach(t => {
                    cleanState[t.id] = initial[t.id] || { hits: 0, misses: 0 };
                });
                return cleanState;
            });

            const [history, setHistory] = useState(() => {
                const saved = localStorage.getItem('shooting_history');
                return saved ? JSON.parse(saved) : [];
            });

            const [view, setView] = useState('tracker');

            useEffect(() => {
                localStorage.setItem('shooting_current_session', JSON.stringify(sessionData));
            }, [sessionData]);

            useEffect(() => {
                localStorage.setItem('shooting_history', JSON.stringify(history));
            }, [history]);

            const vibrate = (ms = 10) => { if (navigator.vibrate) navigator.vibrate(ms); };

            const handleHit = (id) => {
                vibrate(10);
                setSessionData(prev => ({ ...prev, [id]: { ...prev[id], hits: prev[id].hits + 1 } }));
            };

            const handleMiss = (id) => {
                vibrate(30);
                setSessionData(prev => ({ ...prev, [id]: { ...prev[id], misses: prev[id].misses + 1 } }));
            };

            const calculateTotals = (data = sessionData) => {
                let totalHits = 0, totalMisses = 0;
                Object.values(data).forEach(d => { totalHits += d.hits; totalMisses += d.misses; });
                return { totalHits, totalMisses, totalShots: totalHits + totalMisses };
            };

            const totals = calculateTotals();

            const resetSession = () => {
                vibrate(20);
                if (window.confirm("Clear current session?")) {
                    setSessionData(TARGET_TYPES.reduce((acc, t) => ({...acc, [t.id]: { hits: 0, misses: 0 }}), {}));
                    setView('tracker');
                }
            };

            const saveAndEndSession = () => {
                vibrate(20);
                if (totals.totalShots === 0) { alert("No shots to save."); return; }
                const newRecord = { id: Date.now(), date: new Date().toISOString(), data: sessionData, totals: totals };
                setHistory(prev => [newRecord, ...prev]);
                setSessionData(TARGET_TYPES.reduce((acc, t) => ({...acc, [t.id]: { hits: 0, misses: 0 }}), {}));
                setView('history');
            };

            const clearHistory = () => {
                if (window.confirm("Delete all history?")) setHistory([]);
            };

            // --- Views ---

            const TrackerView = () => (
                <div className="space-y-4 animate-in fade-in duration-300">
                    {TARGET_TYPES.map((target) => {
                        const stats = sessionData[target.id];
                        return (
                            <div key={target.id} className="bg-white rounded-2xl shadow-sm border border-slate-100/60 overflow-hidden">
                                <div className="px-4 py-3 flex items-center justify-between bg-slate-50/80 border-b border-slate-100">
                                    <div className="flex items-center gap-3">
                                        <span className="text-2xl drop-shadow-sm filter grayscale-[0.2]">{target.icon}</span>
                                        <h3 className="font-bold text-slate-800 text-lg tracking-tight">{target.name}</h3>
                                    </div>
                                    <div className="text-[10px] font-bold uppercase tracking-wider text-slate-400 bg-slate-200/50 px-2 py-1 rounded-md">
                                        Total: {stats.hits + stats.misses}
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 divide-x divide-slate-100">
                                    <button onClick={() => handleHit(target.id)} className="relative h-28 flex flex-col items-center justify-center bg-gradient-to-br from-emerald-50 to-white active:from-emerald-200 active:to-emerald-100 text-emerald-700 transition-all touch-manipulation group overflow-hidden">
                                        <CheckCircle className="w-8 h-8 mb-1 transition-transform group-active:scale-90" strokeWidth={2.5} />
                                        <span className="text-xs font-black uppercase tracking-widest opacity-70">HIT</span>
                                        <span className="text-2xl font-black mt-1 tabular-nums">{stats.hits}</span>
                                    </button>
                                    <button onClick={() => handleMiss(target.id)} className="relative h-28 flex flex-col items-center justify-center bg-gradient-to-br from-rose-50 to-white active:from-rose-200 active:to-rose-100 text-rose-700 transition-all touch-manipulation group overflow-hidden">
                                        <XCircle className="w-8 h-8 mb-1 transition-transform group-active:scale-90" strokeWidth={2.5} />
                                        <span className="text-xs font-black uppercase tracking-widest opacity-70">MISS</span>
                                        <span className="text-2xl font-black mt-1 tabular-nums">{stats.misses}</span>
                                    </button>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );

            const ReportView = () => (
                <div className="space-y-6 pb-6 animate-in fade-in duration-300">
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                        <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <BarChart2 className="w-5 h-5 text-indigo-600" />
                            Session Summary
                        </h2>
                        <div className="flex gap-3 mb-6">
                            <div className="flex-1 bg-emerald-50/80 rounded-2xl p-3 text-center border border-emerald-100/50 shadow-sm">
                                <div className="text-emerald-600 text-[10px] font-black uppercase tracking-widest mb-1">Hits</div>
                                <div className="text-3xl font-black text-emerald-700 tabular-nums">{totals.totalHits}</div>
                            </div>
                            <div className="flex-1 bg-rose-50/80 rounded-2xl p-3 text-center border border-rose-100/50 shadow-sm">
                                <div className="text-rose-600 text-[10px] font-black uppercase tracking-widest mb-1">Misses</div>
                                <div className="text-3xl font-black text-rose-700 tabular-nums">{totals.totalMisses}</div>
                            </div>
                            <div className="flex-1 bg-slate-50 rounded-2xl p-3 text-center border border-slate-100 shadow-sm">
                                <div className="text-slate-500 text-[10px] font-black uppercase tracking-widest mb-1">Total</div>
                                <div className="text-3xl font-black text-slate-700 tabular-nums">{totals.totalShots}</div>
                            </div>
                        </div>
                        <div className="bg-slate-50 rounded-xl p-4 border border-slate-100">
                            <div className="flex justify-between items-end mb-2">
                                <span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Accuracy</span>
                                <span className="text-2xl font-black text-indigo-600 tabular-nums">
                                    {totals.totalShots > 0 ? Math.round((totals.totalHits / totals.totalShots) * 100) : 0}%
                                </span>
                            </div>
                            <div className="w-full bg-slate-200 rounded-full h-2.5 overflow-hidden">
                                <div className="bg-indigo-600 h-2.5 rounded-full transition-all duration-500" style={{ width: `${totals.totalShots > 0 ? (totals.totalHits / totals.totalShots) * 100 : 0}%` }}></div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                        <div className="bg-slate-50/80 px-5 py-3 border-b border-slate-100 font-bold text-slate-500 text-[10px] uppercase tracking-wider backdrop-blur-sm">
                            Detailed Breakdown
                        </div>
                        <div className="divide-y divide-slate-100">
                            {TARGET_TYPES.map(target => {
                                const stats = sessionData[target.id];
                                // Handle case where target might have been removed but data exists (though resetSession cleans this up usually)
                                if (!stats) return null;
                                
                                const total = stats.hits + stats.misses;
                                const accuracy = total > 0 ? Math.round((stats.hits / total) * 100) : 0;
                                if (total === 0) return null;
                                return (
                                    <div key={target.id} className="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
                                        <div className="flex items-center gap-3">
                                            <span className="text-xl filter grayscale-[0.2]">{target.icon}</span>
                                            <div>
                                                <div className="font-bold text-slate-800 text-sm">{target.name}</div>
                                                <div className="text-[10px] text-slate-400 mt-0.5 font-medium uppercase tracking-wide">
                                                    <span className="text-emerald-600">{stats.hits} hit</span> <span className="text-slate-300">/</span> <span className="text-rose-500">{stats.misses} miss</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className={`text-xs font-bold px-2.5 py-1 rounded-full ${accuracy >= 80 ? 'bg-emerald-100 text-emerald-800' : accuracy >= 50 ? 'bg-yellow-100 text-yellow-800' : 'bg-rose-100 text-rose-800'}`}>
                                                {accuracy}%
                                            </div>
                                            <div className="text-[10px] text-slate-400 mt-1 font-medium">{total} shots</div>
                                        </div>
                                    </div>
                                );
                            })}
                            {totals.totalShots === 0 && <div className="p-8 text-center text-slate-400 text-sm">No shots recorded yet.</div>}
                        </div>
                    </div>

                    <button onClick={saveAndEndSession} className="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold hover:bg-indigo-700 active:scale-[0.98] transition-all flex items-center justify-center gap-2 shadow-lg shadow-indigo-200">
                        <Save className="w-5 h-5" /> Finish & Save
                    </button>
                </div>
            );

            const HistoryView = () => {
                const allTimeStats = history.reduce((acc, session) => {
                    acc.hits += session.totals.totalHits;
                    acc.misses += session.totals.totalMisses;
                    acc.shots += session.totals.totalShots;
                    return acc;
                }, { hits: 0, misses: 0, shots: 0 });

                return (
                    <div className="space-y-6 pb-6 animate-in fade-in duration-300">
                        {history.length > 0 && (
                            <div className="bg-slate-900 text-white rounded-2xl shadow-xl p-5 border border-slate-700">
                                <div className="flex justify-between items-start mb-4">
                                    <h3 className="font-bold text-sm flex items-center gap-2 text-slate-200 uppercase tracking-wide">
                                        <Calendar className="w-4 h-4 text-indigo-400" /> Lifetime Stats
                                    </h3>
                                    <button onClick={clearHistory} className="text-white/40 hover:text-rose-400 p-1 transition-colors"><Trash2 className="w-4 h-4" /></button>
                                </div>
                                <div className="grid grid-cols-3 gap-3 text-center">
                                    <div className="bg-white/5 rounded-xl p-2.5 backdrop-blur-sm">
                                        <div className="text-slate-400 text-[10px] uppercase tracking-wider font-bold mb-1">Shots</div>
                                        <div className="text-xl font-bold">{allTimeStats.shots}</div>
                                    </div>
                                    <div className="bg-emerald-500/10 rounded-xl p-2.5 border border-emerald-500/20 backdrop-blur-sm">
                                        <div className="text-emerald-400 text-[10px] uppercase tracking-wider font-bold mb-1">Hits</div>
                                        <div className="text-xl font-bold text-emerald-100">{allTimeStats.hits}</div>
                                    </div>
                                    <div className="bg-white/5 rounded-xl p-2.5 backdrop-blur-sm">
                                        <div className="text-slate-400 text-[10px] uppercase tracking-wider font-bold mb-1">Acc</div>
                                        <div className="text-xl font-bold text-indigo-300">{allTimeStats.shots > 0 ? Math.round((allTimeStats.hits / allTimeStats.shots) * 100) : 0}%</div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {history.length === 0 ? (
                            <div className="flex flex-col items-center justify-center py-24 text-slate-400">
                                <div className="bg-white p-6 rounded-full mb-4 shadow-sm"><History className="w-10 h-10 text-slate-300" /></div>
                                <p className="font-medium">No history yet</p>
                                <p className="text-xs mt-1 opacity-70">Complete a session to see it here</p>
                            </div>
                        ) : (
                            <div className="space-y-3">
                                <div className="px-1 text-[10px] font-black uppercase tracking-widest text-slate-400">Recent Sessions</div>
                                {history.map((session) => {
                                    const accuracy = session.totals.totalShots > 0 ? Math.round((session.totals.totalHits / session.totals.totalShots) * 100) : 0;
                                    return (
                                        <div key={session.id} className="bg-white rounded-2xl shadow-sm border border-slate-100 p-4 transition-transform active:scale-[0.99]">
                                            <div className="flex justify-between items-center mb-3 pb-3 border-b border-slate-50">
                                                <div>
                                                    <div className="font-bold text-slate-800 text-sm">{new Date(session.date).toLocaleDateString('en-US', {month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'})}</div>
                                                    <div className="text-[10px] font-bold text-slate-400 uppercase tracking-wide mt-0.5">{session.totals.totalShots} shots</div>
                                                </div>
                                                <div className={`px-2.5 py-1 rounded-full text-xs font-black ${accuracy >= 80 ? 'bg-emerald-100 text-emerald-800' : accuracy >= 50 ? 'bg-yellow-100 text-yellow-800' : 'bg-rose-100 text-rose-800'}`}>{accuracy}%</div>
                                            </div>
                                            <div className="flex gap-2 overflow-x-auto pb-1 no-scrollbar mask-gradient-r">
                                                {TARGET_TYPES.map(type => {
                                                    const tStat = session.data[type.id];
                                                    if (!tStat || (tStat.hits === 0 && tStat.misses === 0)) return null;
                                                    return (
                                                        <div key={type.id} className="flex-shrink-0 bg-slate-50/80 rounded-lg px-2 py-1.5 text-[10px] border border-slate-100 flex flex-col items-center min-w-[44px]">
                                                            <span className="text-sm mb-1">{type.icon}</span>
                                                            <span className="font-bold text-emerald-600">{tStat.hits}</span>
                                                        </div>
                                                    )
                                                })}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="w-full max-w-[480px] bg-slate-50 min-h-screen relative shadow-2xl flex flex-col mx-auto overflow-hidden ring-1 ring-slate-900/5">
                    {/* Header */}
                    <header className="sticky top-0 z-50 bg-slate-900/95 backdrop-blur-md text-white pt-safe">
                        <div className="px-5 py-3 flex items-center justify-between h-16">
                            <div className="flex items-center gap-2">
                                <div className="bg-red-500 p-1.5 rounded-lg"><Target className="w-4 h-4 text-white" strokeWidth={3} /></div>
                                <h1 className="text-lg font-bold tracking-tight">Range<span className="text-red-500">Tracker</span></h1>
                            </div>
                            {view === 'tracker' && totals.totalShots > 0 && (
                                <div className="flex items-center gap-3 animate-in fade-in slide-in-from-right-4 duration-300">
                                    <div className="text-xs font-medium text-slate-400 text-right leading-tight">
                                        <span className="text-white font-bold block text-sm">{totals.totalShots}</span> shots
                                    </div>
                                    <button onClick={resetSession} className="bg-white/10 p-2 rounded-full text-white/70 hover:text-white hover:bg-red-500/80 transition-all active:scale-90">
                                        <RotateCcw className="w-4 h-4" />
                                    </button>
                                </div>
                            )}
                        </div>
                    </header>

                    {/* Top Nav (Moved from bottom) */}
                    <nav className="sticky top-16 z-40 bg-white/95 backdrop-blur-lg border-b border-slate-200 shadow-sm">
                        <div className="flex justify-around items-center h-14">
                            {[
                                { id: 'tracker', icon: Crosshair, label: 'Track' },
                                { id: 'report', icon: BarChart2, label: 'Report' },
                                { id: 'history', icon: History, label: 'History' }
                            ].map((item) => (
                                <button 
                                    key={item.id}
                                    onClick={() => setView(item.id)}
                                    className={`flex-1 flex items-center justify-center h-full gap-2 transition-all active:bg-slate-50 ${
                                        view === item.id ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-slate-400 hover:text-slate-600 border-b-2 border-transparent'
                                    }`}
                                >
                                    <item.icon className={`w-5 h-5 ${view === item.id ? 'stroke-[2.5px]' : 'stroke-2'}`} />
                                    <span className="text-xs font-bold uppercase tracking-wide">{item.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="flex-1 w-full px-4 py-6 overflow-y-auto no-scrollbar">
                        {view === 'tracker' && <TrackerView />}
                        {view === 'report' && <ReportView />}
                        {view === 'history' && <HistoryView />}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>